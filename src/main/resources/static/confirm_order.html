<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>杉杉订餐-确认订单</title>
<meta name="author" content="杉杉"/>
<link href="style/style.css" rel="stylesheet" type="text/css" />
 <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/normal.js"></script>
<!--<script type="text/javascript" src="js/public.js"></script>-->

<!--<script type="text/javascript" src="js/jqpublic.js"></script>-->

</head>
<body>
<div id="pay">
<header>
    <section class="Topmenubg">
        <div class="Topnav">
            <div class="LeftNav">
                <!--<a href="register.html">注册</a>/<a href="login.html">登录</a><a href="#">QQ客服</a><a href="#">微信客服</a><a href="#">手机客户端</a>-->
            </div>
            <div class="RightNav">
                <!--<a href="user_center.html">用户中心</a> <a href="user_orderlist.html" target="_blank" title="我的订单">我的订单</a> <a href="cart.html">购物车（0）</a> <a href="user_favorites.html" target="_blank" title="我的收藏">我的收藏</a> <a href="#">商家入驻</a>-->
            </div>
        </div>
    </section>
 <div class="Logo_search">
     <div class="Logo">
         <a href="index.html"><img src="login/images/logo.png" title="DeathGhost" alt="模板"></a>
         <i></i>
         <span id="distict"></span>
     </div>
  <div class="Search"> 
   <form method="get" id="main_a_serach" onsubmit="return check_search(this)">
   <div class="Search_nav" id="selectsearch">
    <a href="javascript:;" onClick="selectsearch(this,'restaurant_name')" class="choose">餐厅</a>
    <a href="javascript:;" onClick="selectsearch(this,'food_name')">食物名</a>
   </div>
   <div class="Search_area"> 
   <input type="search" id="fkeyword" name="keyword" placeholder="请输入您所需查找的餐厅名称或食物名称..." class="searchbox" />
   <input type="submit" class="searchbutton" value="搜 索" />
   </div>
   </form>
      <p class="hotkeywords"><a href="detailsp.html?9" title="香辣鸡翅">香辣鸡翅</a><a href="detailsp.html?6" title="鱼香肉丝">鱼香肉丝</a><a href="detailsp.html?2" title="烤芝士沙拉">烤芝士沙拉</a><a href="detailsp.html?3" title="烧仙草">烧仙草</a><a href="detailsp.html?8" title="秘制烤鸡腿堡">秘制烤鸡腿堡</a><a href="detailsp.html?10" title="可乐">可乐</a></p>
  </div>
 </div>
 <nav class="menu_bg">
  <ul class="menu">
   <li><a href="index.html">首页</a></li>
   <li><a href="list.html">订餐</a></li>
   <li><a href="category.html">积分商城</a></li>
   <li><a href="article_read.html">关于我们</a></li>
  </ul>
 </nav>
</header>
<!--Start content-->
<section class="Psection MT20" id="Cflow">
<!--如果用户未添加收货地址，则显示如下-->
 <div class="confirm_addr_f">
  <span class="flow_title">收货地址：</span>
  <!--如果未添加地址，则显示此表单-->
  <form class="add_address" action="#" style="display:none;">
   <p><i>收件人姓名：</i><input type="text" name="" required></p>
   <p>
   <i>选择所在地：</i> 
   <select name="">
    <option>陕西省</option>
   </select>
   <select name="">
    <option>西安市</option>
   </select>
   <select name="">
    <option>莲湖区</option>
   </select>
   </p>
   <p><i>街道地址：</i><input type="text" required size="50"></p>
   <p><i>邮政编码：</i><input type="text" required size="10" pattern="[0-9]{6}"></p>
   <p><i>手机号码：</i><input type="text" name="" required pattern="[0-9]{11}"></p>
   <p><i></i><input name="" type="submit" value="确定"></p>
  </form>
  <!--已保存的地址列表-->
  <form action="#">
   <ul class="address">
    <li id="style1"><input type="radio" value="" id="1" name="rdColor" onclick="changeColor(1)"/><label for="1" id="label1"> </label></li>
    <li id="style2"><input type="radio" value="" id="2" name="rdColor" onclick="changeColor(2)"/><label for="2" id="label2"> <span class="fontcolor"></span></label></li>
    <li><a href = "javascript:void(0)" onclick = "document.getElementById('light').style.display='block';document.getElementById('fade').style.display='block'"><img src="images/newaddress.png"/></a></li>
   </ul>
   </form>
   <!--add new address-->
   <form action="#">
   <div id="light" class="O-L-content">
    <ul>
     <li><span><label for="">选择所在地：</label></span><p><em>*</em><select name=""><option>陕西省</option></select> <select name=""><option>西安市</option></select> <select name=""><option>雁塔区</option></select></p></li>
     <li><span><label for="">邮政编码：</label></span><p><em>*</em><input name="" type="text"  class="Y_N"  pattern="[0-9]{6}" required></p></li>
     <li><span><label for="">街道地址：</label></span><p><em>*</em><textarea name="" cols="80" rows="5"></textarea></p></li>
     <li><span><label for="">收件人姓名：</label></span><p><em>*</em><input name="" type="text"></p></li>
     <li><span><label for="">手机号码：</label></span><p><em>*</em><input name="" type="text" pattern="[0-9]{11}" required></p></li>
     <div class="button-a"><input type="button" value="确 定" class="C-button" /><a href = "javascript:void(0)" onclick = "document.getElementById('light').style.display='none';document.getElementById('fade').style.display='none'"><span><input name="" type="button" value="取 消"  class="Cancel-b"/></a></div>
    <div class="close-botton"><a href = "javascript:void(0)" onclick = "document.getElementById('light').style.display='none';document.getElementById('fade').style.display='none'"></a></div>
   </div> 
   <div id="fade" class="overlay"></div>
    </ul>
    
   <!--End add new address-->
   </form>
 </div>
<!--配送方式及支付，则显示如下-->
<!--check order or add other information-->
 <div class="pay_delivery">
  <span class="flow_title">配送方式：</span>
  <table>
   <th width="30%">配送方式</th>
   <th width="30%">运费</th>
   <th width="40%">说明</th>
   <tr>
    <td>送货上门</td>
    <td>￥0.00</td>
    <td>配送说明信息...</td>
   </tr>
  </table>
  <span class="flow_title">在线支付方式：</span>
   <form action="#">
    <ul>
    <li><input type="radio" name="pay" id="alipay" value="alipay" /><label for="alipay"><i class="alipay"></i></label></li>
    </ul>
   </form>
  </div>
  <form action="#" id="form1">
  <div class="inforlist">
   <!--<span class="flow_title">商品清单</span>-->
   <!--<table>-->
    <!--<th>名称</th>-->
    <!--<th>数量</th>-->
    <!--<th>价格</th>-->
    <!--<th>小计</th>-->
    <!--<tr>-->
     <!--<td>酸辣土豆丝</td>-->
     <!--<td>2</td>-->
     <!--<td>￥59</td>-->
     <!--<td>￥118</td>-->
    <!--</tr>-->
    <!--<tr>-->
     <!--<td>鱼香肉丝</td>-->
     <!--<td>1</td>-->
     <!--<td>￥59</td>-->
     <!--<td>￥59</td>-->
    <!--</tr>-->
   <!--</table>-->
    <div class="Order_M">
     <p><em>订单附言:</em><input name=""  type="text"></p>
     <p><em>优惠券:</em>
     <select name="">
         <option id="youhuijuan">￥10元优惠券</option>
     </select>
     </p>
    </div>
    <div class="Sum_infor">
    <p class="p1" id="p1"></p>
    <p class="p2" id="p2">合计：<span></span></p>
    <input type="submit" value="提交订单" class="p3button" id="tijiao">
    </div>
   </div>
   </form>
 </div>
</section>
<script>
//Test code,You can delete this script /2014-9-21DeathGhost/
$(document).ready(function(){
 var submitorder =$.noConflict();
 submitorder(".p3button").click(function(){
	 submitorder("#Cflow").hide();
	 submitorder("#Aflow").show();
	 });
});
</script>
<section class="Psection MT20 Textcenter" style="display:none;" id="Aflow">
  <!-- 订单提交成功后则显示如下 -->
  <p class="Font14 Lineheight35 FontW">恭喜你！订单提交成功！</p>
  <p class="Font14 Lineheight35 FontW">您的订单编号为：<span class="CorRed">201409205134</span></p>
    <pan class="Font14 Lineheight35 FontW">共计金额：<pan class="CorRed">￥<pan class="CorRed" id="totalprice"></pan></pan></p>
  <p><button type="button" class="Lineheight35"><a href="javascript:zhifu();" target="_blank" id="zhifu">支付宝立即支付</a></button><button type="button" class="Lineheight35"><a href="user_center.html">进入用户中心</button></p>
</section>

<div class="F-link">
    <span>友情链接：</span>
    <a href="http://localhost:8080/index.html" target="_blank" title="杉杉订餐">杉杉订餐</a>
    <a href="http://www.caixiangyuan.com/" target="_blank" title="菜香源主页">菜香源川菜馆官网</a>
    <a href="http://www.jidongzs.com/?bd_vid=8764546780220336850" target="_blank" title="烧仙草挂网">悸动烧仙草挂网</a>
    <a href="http://www.sohu.com/a/161665425_125537" target="_blank" title="香霏牛排官网">香霏牛排官网</a>
</div>
<footer>
 <section class="Otherlink">
  <aside>
   <div class="ewm-left">
    <p>手机扫描二维码：</p>
    <img src="images/Android_ico_d.gif">
    <img src="images/iphone_ico_d.gif">
   </div>
   <div class="tips">
    <p>客服热线</p>
    <p><i>1830927**73</i></p>
    <p>配送时间</p>
    <p><time>09：00</time>~<time>22:00</time></p>
    <p>网站公告</p>
   </div>
  </aside>
  <section>
    <div>
    <span><i class="i1"></i>配送支付</span>
    <ul>
     <li><a href="article_read.html" target="_blank" title="标题">支付方式</a></li>
     <li><a href="article_read.html" target="_blank" title="标题">配送方式</a></li>
     <li><a href="article_read.html" target="_blank" title="标题">配送效率</a></li>
     <li><a href="article_read.html" target="_blank" title="标题">服务费用</a></li>
    </ul>
    </div>
    <div>
    <span><i class="i2"></i>关于我们</span>
    <ul>
     <li><a href="article_read.html" target="_blank" title="标题">招贤纳士</a></li>
     <li><a href="article_read.html" target="_blank" title="标题">网站介绍</a></li>
     <li><a href="article_read.html" target="_blank" title="标题">配送效率</a></li>
     <li><a href="article_read.html" target="_blank" title="标题">商家加盟</a></li>
    </ul>
    </div>
    <div>
    <span><i class="i3"></i>帮助中心</span>
    <ul>
     <li><a href="article_read.html" target="_blank" title="标题">服务内容</a></li>
     <li><a href="article_read.html" target="_blank" title="标题">服务介绍</a></li>
     <li><a href="article_read.html" target="_blank" title="标题">常见问题</a></li>
     <li><a href="article_read.html" target="_blank" title="标题">网站地图</a></li>
    </ul>
    </div>
  </section>
 </section>
    <div class="copyright">© 版权所有 2016 DeathGhost 技术支持：<a href="http://www.deathghost.cn" title="587工作室">587工作室</a></div>
</footer>
</div>
</body>
<script type="text/javascript">
    //禁止表单默认行为--------------------------------------------------------------
    $("#form1").submit(function (e) {
        e.preventDefault();
    });
    //获取用户基本信息----------------------------------------------------------------
    var user=sessionStorage.getItem("name");
    var userId;
    var userPhone;

    var json = {
        name: user
    };
    json = JSON.stringify(json);
    $.ajax({
        type: "POST",
        url: "/GetUserInfo",
        contentType: "application/json; charset=utf-8",
        data: json,
        async: false,
        dataType: "json",
        success: function (info) {
            console.log(info);
            userId=info.user.userId;
            userPhone=info.user.userPhone;
        },
        error: function (message) {
            $("#request-process-patent").html("获取数据失败！");
        }
    });
    //获取用户地址----------------------------------------------------------
    var json = {
        id: userId
    };
    json = JSON.stringify(json);
    $.ajax({
        type: "POST",
        url: "/getAddressByUser",
        contentType: "application/json; charset=utf-8",
        data: json,
        async: false,
        dataType: "json",
        success: function (info) {
            var count=0;
            for(var i=0;i<info.address.length;i++){
                var addressProvence=info.address[i].addressProvence;
                var addressCity=info.address[i].addressCity;
                var addressDistrict=info.address[i].addressDistrict;
                var addressStreet=info.address[i].addressStreet;
                count=i+1;
                var phone=userPhone.replace(/(\d{3})\d{4}(\d{4})/, '$1****$2');
                $("#label"+count).append(addressProvence+"  "+addressCity+"市   "+addressDistrict+"  "+addressStreet+ "  "+"（"+user+ " 先生）"+"<span class=\"fontcolor\">"+phone+"</span>");
            }

        },
        error: function (message) {
            $("#request-process-patent").html("获取数据失败！");
        }
    });
    //用户支付------------------------------------------------------------------------
    var zhifu= (function () {
        var price=jQuery("#totalprice").html();
        console.log(price);
        var json = {
            userId: userId,
            price:price
        };
        json = JSON.stringify(json);
        jQuery.ajax({
            type: "POST",
            url: "/getPagePay2",
            contentType: "application/json; charset=utf-8",
            data: json,
            async: false,
            dataType: "json",
            success: function (info) {
                console.log(info);
                var pay=info.pays.pay;
                jQuery("#pay").empty();
                jQuery("#pay").append(pay);
            },
            error: function (message) {
                jQuery("#request-process-patent").html("获取数据失败！");
            }
        });

    })
    $(function(){
        // var foodlist=sessionStorage.getItem("foodlist");
        // console.log(foodlist);
        // var jsonData = JSON.stringify(foodlist);// 转成JSON格式
        // console.log(jsonData);
        // var result = jQuery.parseJSON(jsonData);//
        // console.log(result);
        var user=sessionStorage.getItem("name");
        console.log(user);
        var totalprice=sessionStorage.getItem("totalprice");
        jQuery("#p1").append("配送费用：￥0.00+商品费用：￥"+totalprice+"-优惠券：￥10.00");
        var youhuijuan=jQuery("#youhuijuan").html();
        console.log(youhuijuan);
        var youhuiprice=youhuijuan.replace(/[^0-9]/ig,"");
        console.log(youhuiprice);
        var totalprice2=totalprice-youhuiprice;
        jQuery("#p2").append("￥"+totalprice2+"");
        jQuery("#totalprice").append(totalprice2);
        if(user==null){
            jQuery(".LeftNav").append(" <a href=\"login/register.html\">注册</a>/<a href=\"login/login.html\">登录</a><a href=\"#\">QQ客服</a><a href=\"#\">微信客服</a><a href=\"#\">手机客户端</a>");
            jQuery(".RightNav").append(" <a href=\"user_center.html\">用户中心</a> <a href=\"user_orderlist.html\" target=\"_blank\" title=\"我的订单\">我的订单</a> <a href=\"cart.html\">购物车（0）</a> <a href=\"user_favorites.html\" target=\"_blank\" title=\"我的收藏\">我的收藏</a> <a href=\"#\">商家入驻</a>");

        }
        else{
            jQuery(".LeftNav").append(" <a href=\"javascript:redirect();\">退出登录</a><a href=\"#\">QQ客服</a><a href=\"#\">微信客服</a><a href=\"#\">手机客户端</a>");
            var json = {
                name: user
            };
            json = JSON.stringify(json);
            var cityname=null;
            jQuery.ajax({
                type: "POST",
                url: "/GetUserCityInfo",
                contentType: "application/json; charset=utf-8",
                data: json,
                async: false,
                dataType: "json",
                success: function (info) {
                    var city=info.user.city;
                    cityname=city;
                    var distict=info.user.distict;
                    jQuery("#distict").append(city+ "[ <a href=\"#\">"+distict+"</a> ]");
                },
                error: function (message) {
                    jQuery("#request-process-patent").html("获取数据失败！");
                }
            });
            jQuery.ajax({
                type: "POST",
                url: "/findCartByuser",
                contentType: "application/json; charset=utf-8",
                data: json,
                async: false,
                dataType: "json",
                success: function (info) {
                    var length=info.cart.length;
                    jQuery(".RightNav").append("<a href=\"user_center.html\">用户中心</a> <a href=\"user_orderlist.html\" target=\"_blank\" title=\"我的订单\">我的订单</a> <a href=\"cart.html\">购物车（"+length+"）</a> <a href=\"user_favorites.html\" target=\"_blank\" title=\"我的收藏\">我的收藏</a> <a href=\"#\">商家入驻</a>");
                }
            });

        }
    });
</script>
</html>
