<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>杉杉订餐-用户中心</title>
<meta name="keywords" content="DeathGhost,DeathGhost.cn,web前端设,移动WebApp开发" />
<meta name="description" content="DeathGhost.cn::H5 WEB前端设计开发!" />
<meta name="author" content="DeathGhost"/>
<link href="style/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/public.js"></script>
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/jqpublic.js"></script>
    <script type="text/javascript" src="js/normal.js"></script>
<!--
Author: DeathGhost
Author URI: http://www.deathghost.cn
-->
</head>
<body>
<header>
    <section class="Topmenubg">
        <div class="Topnav">
            <div class="LeftNav">
                <!--<a href="login/register.html">注册</a>/<a href="login/login.html">登录</a><a href="#">QQ客服</a><a href="#">微信客服</a><a href="#">手机客户端</a>-->
            </div>
            <div class="RightNav">
                <!--<a href="user_center.html">用户中心</a> <a href="user_orderlist.html" target="_blank" title="我的订单">我的订单</a> <a href="cart.html">购物车（0）</a> <a href="user_favorites.html" target="_blank" title="我的收藏">我的收藏</a> <a href="#">商家入驻</a>-->
            </div>
        </div>
    </section>
 <div class="Logo_search">
     <div class="Logo">
         <a href="index.html"><img src="login/images/logo.png" title="杉杉订餐" alt="模板"></a>
         <i></i>
         <span id="distict"></span>
     </div>
  <div class="Search"> 
   <form method="get" id="main_a_serach" onsubmit="return check_search(this)">
   <div class="Search_nav" id="selectsearch">
    <a href="javascript:;" onClick="selectsearch(this,'restaurant_name')" class="choose">餐厅</a>
    <a href="javascript:;" onClick="selectsearch(this,'food_name')">食物名</a>
   </div>
   <div class="Search_area"> 
   <input type="search" id="fkeyword" name="keyword" placeholder="请输入您所需查找的餐厅名称或食物名称..." class="searchbox" />
   <input type="submit" class="searchbutton" value="搜 索" />
   </div>
   </form>
      <p class="hotkeywords"><a href="#" title="酸辣土豆丝">干煸肥肠</a><a href="#" title="这里是产品名称">鱼香肉丝</a><a href="#" title="这里是产品名称">烤芝士沙拉</a><a href="#" title="这里是产品名称">烧仙草</a><a href="#" title="这里是产品名称">秘制烤鸡腿堡</a><a href="#" title="这里是产品名称">糖醋里脊</a></p>
  </div>
 </div>
 <nav class="menu_bg">
  <ul class="menu">
   <li><a href="index.html">首页</a></li>
   <li><a href="list.html">订餐</a></li>
   <li><a href="category.html">积分商城</a></li>
   <li><a href="article_read.html">关于我们</a></li>
  </ul>
 </nav>
</header>
<!--Start content-->
<section class="Psection MT20">
<nav class="U-nav Font14 FontW">
  <ul>
   <li><i></i><a href="user_center.html">用户中心首页</a></li>
   <li><i></i><a href="user_orderlist.html">我的订单</a></li>
   <li><i></i><a href="user_address.html">收货地址</a></li>
   <li><i></i><a href="user_message.html">我的留言</a></li>
   <li><i></i><a href="user_coupon.html">我的优惠券</a></li>
   <li><i></i><a href="user_favorites.html">我的收藏</a></li>
   <li><i></i><a href="user_account.html">账户管理</a></li>
   <li><i></i><a href="#">安全退出</a></li>
  </ul>
 </nav>
 <article class="U-article Overflow">
  <!--user order list-->
  <section>
    <table class="Myorder">
     <th class="Font14 FontW">订单编号</th>
     <th class="Font14 FontW">下单时间</th>
     <th class="Font14 FontW">收件人</th>
     <th class="Font14 FontW">订单总金额</th>
     <th class="Font14 FontW">订单状态</th>
     <th class="Font14 FontW">操作</th>
     <!--<tr>-->
      <!--<td class="FontW"><a href="user_order.html">201409225367</a></td>-->
      <!--<td>2014-09-22 19:21:38</td>-->
      <!--<td>DeathGhost</td>-->
      <!--<td>￥328.00</td>-->
      <!--<td>未付款,未发货</td>-->
      <!--<td><a href="#">取消订单</a> | <a href="#">付款</a></td>-->
     <!--</tr>-->
    </table>
    <div class="TurnPage">
         <a href="#">
          <span class="Prev"><i></i>首页</span>
         </a>
         <a href="#"><span class="PNumber">1</span></a>
         <!--<a href="#"><span class="PNumber">2</span></a>-->
         <a href="#">
         <span class="Next">最后一页<i></i></span>
        </a>
       </div>
  </section>
 </article>
</section>
<!--End content-->
<div class="F-link">
    <span>友情链接：</span>
    <a href="http://localhost:8080/index.html" target="_blank" title="杉杉订餐">杉杉订餐</a>
    <a href="http://www.caixiangyuan.com/" target="_blank" title="菜香源主页">菜香源川菜馆官网</a>
    <a href="http://www.jidongzs.com/?bd_vid=8764546780220336850" target="_blank" title="烧仙草挂网">悸动烧仙草挂网</a>
    <a href="http://www.sohu.com/a/161665425_125537" target="_blank" title="香霏牛排官网">香霏牛排官网</a>
</div>
<footer>
 <section class="Otherlink">
  <aside>
   <div class="ewm-left">
    <p>手机扫描二维码：</p>
    <img src="images/Android_ico_d.gif">
    <img src="images/iphone_ico_d.gif">
   </div>
   <div class="tips">
    <p>客服热线</p>
    <p><i>1830927**73</i></p>
    <p>配送时间</p>
    <p><time>09：00</time>~<time>22:00</time></p>
    <p>网站公告</p>
   </div>
  </aside>
  <section>
    <div>
    <span><i class="i1"></i>配送支付</span>
    <ul>
     <li><a href="article_read.html" target="_blank" title="标题">支付方式</a></li>
     <li><a href="article_read.html" target="_blank" title="标题">配送方式</a></li>
     <li><a href="article_read.html" target="_blank" title="标题">配送效率</a></li>
     <li><a href="article_read.html" target="_blank" title="标题">服务费用</a></li>
    </ul>
    </div>
    <div>
    <span><i class="i2"></i>关于我们</span>
    <ul>
     <li><a href="article_read.html" target="_blank" title="标题">招贤纳士</a></li>
     <li><a href="article_read.html" target="_blank" title="标题">网站介绍</a></li>
     <li><a href="article_read.html" target="_blank" title="标题">配送效率</a></li>
     <li><a href="article_read.html" target="_blank" title="标题">商家加盟</a></li>
    </ul>
    </div>
    <div>
    <span><i class="i3"></i>帮助中心</span>
    <ul>
     <li><a href="article_read.html" target="_blank" title="标题">服务内容</a></li>
     <li><a href="article_read.html" target="_blank" title="标题">服务介绍</a></li>
     <li><a href="article_read.html" target="_blank" title="标题">常见问题</a></li>
     <li><a href="article_read.html" target="_blank" title="标题">网站地图</a></li>
    </ul>
    </div>
  </section>
 </section>
<div class="copyright">© 版权所有 2016 DeathGhost 技术支持：<a href="http://www.deathghost.cn" title="587工作室">587工作室</a></div>
</footer>
<script type="text/javascript">
    function add0(m){return m<10?'0'+m:m }
    function format(timestamp)
    {
        //timestamp是整数，否则要parseInt转换,不会出现少个0的情况
        var time = new Date(timestamp);
        var year = time.getFullYear();
        var month = time.getMonth()+1;
        var date = time.getDate();
        var hours = time.getHours();
        var minutes = time.getMinutes();
        var seconds = time.getSeconds();
        return year+'-'+add0(month)+'-'+add0(date)+' '+add0(hours)+':'+add0(minutes)+':'+add0(seconds);
    }
    $(function(){
        var user=sessionStorage.getItem("name");
        var userId;
        console.log(user);
        if(user==null){
            $(".LeftNav").append(" <a href=\"login/register.html\">注册</a>/<a href=\"login/login.html\">登录</a><a href=\"#\">QQ客服</a><a href=\"#\">微信客服</a><a href=\"#\">手机客户端</a>");
            $(".RightNav").append(" <a href=\"user_center.html\">用户中心</a> <a href=\"user_orderlist.html\" target=\"_blank\" title=\"我的订单\">我的订单</a> <a href=\"cart.html\">购物车（0）</a> <a href=\"user_favorites.html\" target=\"_blank\" title=\"我的收藏\">我的收藏</a> <a href=\"#\">商家入驻</a>");
            $(".seekarea").append(" <a href=\"#\">碑林区</a>\n" +
                "     <a href=\"#\">新城区</a>\n" +
                "     <a href=\"#\">未央区</a>\n" +
                "     <a href=\"#\">雁塔区</a>\n" +
                "     <a href=\"#\">莲湖区</a>\n" +
                "     <a href=\"#\">高新区</a>\n" +
                "     <a href=\"#\">灞桥区</a>\n" +
                "     <a href=\"#\">高陵区</a>\n" +
                "     <a href=\"#\">阎良区</a>\n" +
                "     <a href=\"#\">临潼区</a>\n" +
                "     <a href=\"#\">长安区</a>\n" +
                "     <a href=\"#\">周至县</a>\n" +
                "     <a href=\"#\">蓝田县 </a>");
        }
        else{
            $(".LeftNav").append(" <a href=\"javascript:redirect();\">退出登录</a><a href=\"#\">QQ客服</a><a href=\"#\">微信客服</a><a href=\"#\">手机客户端</a>");
            var json = {
                name: user
            };
            json = JSON.stringify(json);
            var cityname=null;
            $.ajax({
                type: "POST",
                url: "/GetUserCityInfo",
                contentType: "application/json; charset=utf-8",
                data: json,
                async: false,
                dataType: "json",
                success: function (info) {
                    var city=info.user.city;
                    cityname=city;
                    var distict=info.user.distict;
                    $("#distict").append(city+ "[ <a href=\"#\">"+distict+"</a> ]");
                },
                error: function (message) {
                    $("#request-process-patent").html("获取数据失败！");
                }
            });
            $.ajax({
                type: "POST",
                url: "/findCartByuser",
                contentType: "application/json; charset=utf-8",
                data: json,
                async: false,
                dataType: "json",
                success: function (info) {
                    var length=info.cart.length;
                    $(".RightNav").append("<a href=\"user_center.html\">用户中心</a> <a href=\"user_orderlist.html\" target=\"_blank\" title=\"我的订单\">我的订单</a> <a href=\"cart.html\">购物车（"+length+"）</a> <a href=\"user_favorites.html\" target=\"_blank\" title=\"我的收藏\">我的收藏</a> <a href=\"#\">商家入驻</a>");
                }
            });
            $.ajax({
                type: "POST",
                url: "/GetUserInfo",
                contentType: "application/json; charset=utf-8",
                data: json,
                async: false,
                dataType: "json",
                success: function (info) {
                    userId=info.user.userId;
                },
                error: function (message) {
                    $("#request-process-patent").html("获取数据失败！");
                }
            });
            var json = {
                userId: userId
            };
            json = JSON.stringify(json);
            $.ajax({
                type: "POST",
                url: "/selectOrderByUserId",
                contentType: "application/json; charset=utf-8",
                data: json,
                async: false,
                dataType: "json",
                success: function (info) {
                    console.log(info);
                    var count_fu2=0;
                    var count0=0;
                    var count1=0;
                    var count2=0;
                    for(var i=0;i<info.order.length;i++){
                        var state=info.order[i].orderstate;
                        var orderno=info.order[i].orderno;
                        var orderno_=orderno+"f";
                        var createtime1=info.order[i].createtime;
                        var createtime=format(createtime1);
                        var price=info.order[i].price;
                        console.log(state);
                        if(state==0){//0未付款，未发货
                            count_fu2=count_fu2+1;
                            $(".Myorder").append(" <tr id=\"tr"+i+"\">\n" +
                                "      <td class=\"FontW\"><a href=\"user_order.html?"+orderno+"\">"+orderno+"</a></td>\n" +
                                "      <td>"+createtime+"</td>\n" +
                                "      <td>"+user+"</td>\n" +
                                "      <td>￥"+price+"</td>\n" +
                                "      <td>未付款,未发货</td>\n" +
                                "      <td><a href=\"#\" class=\"quxiao\"id="+orderno+" >取消订单</a> | <a href=\"#\" class=\"fukuan\" id="+orderno_+">付款</a></td>\n" +
                                "     </tr>");
                        }
                        else  if(state==1){//1已付款,未发货
                            count0=count0+1;
                            $(".Myorder").append(" <tr id=\"tr"+i+"\">\n" +
                                "      <td class=\"FontW\"><a href=\"user_order.html?"+orderno+"\">"+orderno+"</a></td>\n" +
                                "      <td>"+createtime+"</td>\n" +
                                "      <td>"+user+"</td>\n" +
                                "      <td>￥"+price+"</td>\n" +
                                "      <td>已付款,未发货</td>\n" +
                                "      <td><a href=\"#\" class=\"quxiao\" id="+orderno+">取消订单</a>" +
                                "     </tr>");
                        }
                        else if(state==2){//2已发货,配送中
                            count1=count1+1;
                            $(".Myorder").append(" <tr id=\"tr"+i+"\">\n" +
                                "      <td class=\"FontW\"><a href=\"user_order.html?"+orderno+"\">"+orderno+"</a></td>\n" +
                                "      <td>"+createtime+"</td>\n" +
                                "      <td>"+user+"</td>\n" +
                                "      <td>￥"+price+"</td>\n" +
                                "      <td>已发货,配送中</td>\n" +
                                "      <td><a href=\"#\" class=\"quxiao\" id="+orderno+">取消订单</a> " +
                                "     </tr>");
                        }
                        else if(state==3){//3确认收货,未评价
                            count2=count2+1;
                            $(".Myorder").append(" <tr id=\"tr"+i+"\">\n" +
                                "      <td class=\"FontW\"><a href=\"user_order.html?"+orderno+"\">"+orderno+"</a></td>\n" +
                                "      <td>"+createtime+"</td>\n" +
                                "      <td>"+user+"</td>\n" +
                                "      <td>￥"+price+"</td>\n" +
                                "      <td>确认收货,未评价</td>\n" +
                                "      <td><a href=\"#\" class=\"pingjia\" id="+orderno+">给予评价</a> " +
                                "     </tr>");
                        }
                        // else if(state==4){//4确认收货,完成评价
                        //     count2=count2+1;
                        //     $(".Myorder").append(" <tr id=\"tr"+i+"\">\n" +
                        //         "      <td class=\"FontW\"><a href=\"user_order.html?"+orderno+"\">"+orderno+"</a></td>\n" +
                        //         "      <td>"+createtime+"</td>\n" +
                        //         "      <td>"+user+"</td>\n" +
                        //         "      <td>￥"+price+"</td>\n" +
                        //         "      <td>确认收货,未评价</td>\n" +
                        //         "      <td><a href=\"#\" class=\"pingjia\" id="+orderno+">给予评价</a> " +
                        //         "     </tr>");
                        // }
                        else if(state==5){//5申请取消中
                            count2=count2+1;
                            $(".Myorder").append(" <tr id=\"tr"+i+"\">\n" +
                                "      <td class=\"FontW\"><a href=\"user_order.html?"+orderno+"\">"+orderno+"</a></td>\n" +
                                "      <td>"+createtime+"</td>\n" +
                                "      <td>"+user+"</td>\n" +
                                "      <td>￥"+price+"</td>\n" +
                                "      <td>订餐正在取消中...</td>\n" +
                                "      <td><a href=\"#\" class=\"pingjia\" id="+orderno+">给予评价</a> " +
                                "     </tr>");
                        }
                        //6退货完成
                    }
                },
                error: function (message) {
                    $("#request-process-patent").html("获取数据失败！");
                }
            });
            $(".quxiao").click(function () {
                var orderno=$(this).attr('id');
                var json = {
                    orderno: orderno
                };
                json = JSON.stringify(json);
                $.ajax({
                    type: "POST",
                    url: "/deleteOrderByNo2",
                    contentType: "application/json; charset=utf-8",
                    data: json,
                    async: false,
                    dataType: "json",
                    success: function (info) {
                        window.location.href="user_orderlist.html";
                    },
                    error: function (message) {
                        $("#request-process-patent").html("获取数据失败！");
                    }
                });
            });
            $(".fukuan").click(function () {
                var orderno_=$(this).attr("id");
                var orderno=orderno_.split("f")[0];
                var json = {
                    orderNo: orderno
                };
                json = JSON.stringify(json);
                $.ajax({
                    type: "POST",
                    url: "/selectOrder",
                    contentType: "application/json; charset=utf-8",
                    data: json,
                    async: false,
                    dataType: "json",
                    success: function (info) {
                        console.log(info);
                        var orderno=info.order.orderno;
                        var price=info.order.price;
                        window.location.href ="confirm_ordered.html?"+orderno+"a"+price;
                    },
                    error: function (message) {
                        $("#request-process-patent").html("获取数据失败！");
                    }
                });
            })
        }
    });
</script>
</body>
</html>
